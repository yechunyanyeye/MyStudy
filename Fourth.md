#### 第四章    变量,作用域和内存问题 



##### 4.1  基本类型和引用类型的值  



基本类型:  简单的数据段

引用类型:可能由多个值构成的对象 .

在操作对象的时候,事实上是在操作对象的引用,而不是实际的对象.  引用类型的值是按引用访问的.



###### 4.1.1  动态的属性

1. 我们可以给对象添加属性,这个属性会一直存在着,除非这个属性被删除了,或者这个对象被销毁了
2. 不可以给基本类型添加属性,不报错,但是访问的时候会是undefined



###### 4.1.2  复制变量值

1. 复制基本类型的值, 值相同,但是所处的内存不一样,就是单纯的把值复制了一遍,给了另外一个变量  .
2. 复制引用类型的值,复制的里面是一个指针,指的(原值)的位置,两个用的同一个空间位置,一改俱改.



###### 4.1.3  传递参数

1. js里面所有的参数都是按照值传递的. 
2. 向参数传递基本类型, 被传递的值会被复制给一个局部变量;

​       向参数传递引用类型的值,会把这个值在内存中的地址复制给局部变量,所以改变了这个局部变量,外部的那个值,也会改变.





###### 4.1.4  检测类型

介绍了instanceof  来检测引用类型到底是什么类型的.

用法 : alert(person instanceof  Object)    //true

规定 :  所有的引用类型的值都是Object的实例,如果用instanceof 检测基本类型,会返回false.



##### 4.2  执行环境及作用域   

  1.在web浏览器中,  全局执行环境被认为是window对象.因此,所有全局变量和函数都是作为window对象的属性和方法创建的.

  2 . 函数在运行时,被推入环境栈中,执行后,被弹出.

  3.作用域链,用途就是保证对执行环境有权访问的所有变量和函数的有序访问.  前端是arguments对象,最后一个对象是全局执行环境的变量对象.

   4.变量访问的时候,子环境可以访问父亲环境的变量,反过来就不可以.



###### 4.2.1  延长作用域链

什么情况下会加长  ? 

答  :   下列两种情况之一 :     

   1.try-catch语句的catch块

            2. with 语句



加长原因  :  在作用域链前端添加一个变量对象:

​             with添加的是指定对象

​             catch添加的是一个包含被抛出的错误对象的声明  的变量对象.



###### 4.2.2  没有块级作用域



  啥意思呢   ?     就是在if  / for   里面定义的变量,在  }   之外还是可以访问到  .



1.声明变量

   使用var 声明的变量会自动被添加到最接近的环境当中.    如果没有使用var声明  ,直接就被添加到全局环境里面去了.

   

2.查询标识符

​        向上查询   (先在自己的环境里面找,找到了就停止,没找到就继续到下一个变量对象里面去找,!!!   全局是最后一个变量对象哈)

​       如果在局部环境中找到了,就不会使用父环境里面的同名标识符.



##### 4.3  垃圾收集

   js有自动垃圾收集机制 (java也有),  垃圾收集器会按照固定的时间间隔 ,周期性的执行这个操作 .



4. ###### 3.1   标记清除

   

   1.  是一种垃圾收集方式.
   2. 就先给所有的变量加上标记,然后还在使用的变量去掉标记.剩下的还有标记的就是要被清除的了

   

######    4.3.2  引用计数

​           

​           1.是一种不太常见的垃圾收集策略.

​            2.就是对引用数据,跟踪记录使用次数,被用到加一,被改变减一,到了0  就被清除了.

​            3.循环引用,招致一堆麻烦

​            4.不用的对象设置为null,就可以回收内存



###### 4.3.3   性能问题

​     emmm,周期性运行,什么条件下运行使得性能最好?  这里有IE的前车之鉴,后面就是   如果内存分配量低于15%,就要把其他的临界值加倍,然后此举极大的提升了性能.



###### 4.3.4  管理内存

   一旦数据不再有用,我们最好给他赋值null,来释放其引用  ------叫做   解除引用.

  不过,解除胡一个值的引用并不意味着自动回收该值所占内存. 解除引用的真正作用是让值脱离执行环境,便于下次垃圾收集器自动回收.







  

